<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D2 Diagram Test - NPM Package</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ D2 Diagram Test - NPM Package (@terrastruct/d2)</h1>

        <div class="status success">
            ‚úÖ Using locally installed npm package instead of CDN
        </div>

        <p><strong>This test verifies that D2 diagrams render using the npm package</strong></p>

        <div class="test-section">
            <h2>Test 1: Simple Connection</h2>
            <button onclick="renderTest1()">Render Simple D2</button>
            <div id="test1" class="diagram-container"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Architecture Diagram</h2>
            <button onclick="renderTest2()">Render Architecture</button>
            <div id="test2" class="diagram-container"></div>
        </div>

        <div class="test-section">
            <h2>Test 3: Styled Diagram</h2>
            <button onclick="renderTest3()">Render Styled Diagram</button>
            <div id="test3" class="diagram-container"></div>
        </div>

        <div class="test-section">
            <h2>Test 4: Complex Flow</h2>
            <button onclick="renderTest4()">Render Complex Flow</button>
            <div id="test4" class="diagram-container"></div>
        </div>

        <div class="test-section">
            <button onclick="renderAllTests()" style="background: #28a745; font-size: 18px; padding: 15px 30px;">
                ‚úÖ Run All Tests
            </button>
        </div>
    </div>

    <script type="module">
        import * as d2 from 'https://unpkg.com/@terrastruct/d2@0.1.33/lib/index.js';

        window.renderDiagram = async function(containerId, code, title) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<div style="padding: 20px; color: #666;">Rendering...</div>';

            try {
                const result = await d2.compile(code, {
                    layout: 'dagre',
                    sketch: false,
                });

                const svg = result.data;

                container.innerHTML = `
                    <h3 style="color: #667eea; margin-top: 0;">${title}</h3>
                    <div class="status success">‚úÖ Successfully rendered using @terrastruct/d2</div>
                    ${svg}
                `;
            } catch (error) {
                container.innerHTML = `
                    <h3 style="color: #e74c3c;">${title}</h3>
                    <div class="status error">‚ùå Error: ${error.message}</div>
                    <pre>${code}</pre>
                `;
            }
        };

        window.renderTest1 = function() {
            const code = `x -> y`;
            renderDiagram('test1', code, 'Simple Connection Test');
        };

        window.renderTest2 = function() {
            const code = `Frontend -> Backend: API Request
Backend -> Database: Query
Database -> Backend: Results
Backend -> Frontend: Response`;
            renderDiagram('test2', code, 'Architecture Diagram Test');
        };

        window.renderTest3 = function() {
            const code = `Server.shape: rectangle
Server.style.fill: "#667eea"
Server.style.stroke: "#5568d3"

Client.shape: rectangle
Client.style.fill: "#48bb78"

Server -> Client: Data`;
            renderDiagram('test3', code, 'Styled Diagram Test');
        };

        window.renderTest4 = function() {
            const code = `User Request -> API Gateway
API Gateway -> Auth Service
Auth Service -> API Gateway: Token
API Gateway -> Business Logic
Business Logic -> Database
Database -> Business Logic: Data
Business Logic -> Cache
Cache -> Business Logic: Cached Data
Business Logic -> API Gateway
API Gateway -> User Request: Response`;
            renderDiagram('test4', code, 'Complex Flow Test');
        };

        window.renderAllTests = function() {
            renderTest1();
            setTimeout(() => renderTest2(), 200);
            setTimeout(() => renderTest3(), 400);
            setTimeout(() => renderTest4(), 600);
        };

        // Auto-run first test on load
        setTimeout(() => renderTest1(), 500);
    </script>
</body>
</html>
